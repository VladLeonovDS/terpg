# Workdir Roguelike

Терминальный Java 17-проект про борьбу с "файловыми" врагами. Имеет два игровых интерфейса: основную аренную сцену на Lanterna и детерминированный пошаговый рогалик на сетке, который используется для демо и тестов.

## Что реализовано
- **Детерминизм по seed** — одинаковые значения воспроизводят одни и те же карты и очереди врагов в обоих режимах.
- **Два интерфейса**:
  - *Lanterna-арена* (запускается из jar по умолчанию) с выбором противника и чередованием ходов.
  - *Пошаговый рогалик* на сетке для демо/тестов с генератором уровней и чтением snapshot-файлов.
- **HP как форматируемые строки**: утилиты меняют основание, представление с плавающей точкой, научную запись, глитч-флаг и т. п.
- **Файловые архетипы врагов** (`JSON`, `LOG`, `ARCHIVE`, `DIR`, `TXT` и др.) с разным HP и базой представления.

## Геймплей
### Lanterna-арена (по умолчанию)
1. На экране выбора перемещайтесь стрелками ↑/↓, `Enter` начинает бой с отмеченным врагом, `q` завершает забег.
2. В бою: `Q` — базовая атака (урон зависит от основания HP врага); `W` открывает список утилит (стрелки + `Enter`, `Esc` — назад).
3. Энергия восстанавливается на 3 в начало вашего хода, лог последних действий отображается под подсказкой.
4. Вражеский ход либо наносит 4–8 урона, либо понижает основание своего HP; заморозка (`determinism`) пропускает ход.

### Пошаговый рогалик (класс `Game`)
1. Передвижение по сетке `WASD`, `u` — выбор утилиты по номеру, `q` — выход.
2. Режимы генерации:
   - `sandbox` — случайная карта с врагами;
   - `readonlyscan` — чтение списка узлов из указанного каталога без модификации ФС;
   - `demo` — загрузка snapshot-JSON (`src/main/resources/snapshots/demo.json` по умолчанию).
3. При контакте с врагом запускается пошаговый `BattleEngine` с автоматическим выбором доступной утилиты.

### Утилиты
- `baseconv` — смена основания HP с утечкой ~10% HP.
- `fmt` — нормализует строку HP и наносит 1–3 урона.
- `sanitize` — лечит NaN/∞/битый формат и убирает глитчи.
- `hash` — выводит контрольную сумму HP и псевдо-прогноз ветки RNG.
- `grep` — наносит урон за совпадения паттерна в строке HP.
- `sed` — точечная замена символов, урон 0–4.
- `determinism` — замораживает врага на ход и фиксирует формат.
- `entropy` — хаотично меняет основание/формат и может усилить или ослабить врага.

## Сборка
Требуются Java 17+ и Maven.

```bash
mvn -q package
```

Fat-jar появляется в `target/workdir-roguelike-0.1.0-shaded.jar`.

## Запуск
Lanterna-арена с фиксированным seed:

```bash
java -jar target/workdir-roguelike-0.1.0-shaded.jar --seed=12345
```

Доступные аргументы командной строки:
- `--seed=<число>` — детерминизм RNG.
- `--mode=sandbox|readonlyscan|demo` и `--snapshot=<путь>` — выбор источника карты для сеточного режима/тестов.

## Тестирование и детерминизм
- Unit-тесты в `src/test/java/org/terpg/workdir` проверяют детерминированный лог пошагового режима.
- Запуск тестов:

```bash
mvn -q test
```

## Структура проекта
- `src/main/java/org/terpg/workdir` — игровые сущности, утилиты, два игровых цикла.
- `src/main/resources/snapshots` — демо-снимки для режима `demo`.
- `src/test/java/org/terpg/workdir` — проверки детерминизма и представления HP.
