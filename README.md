# Workdir Roguelike

Терминальный рогалик на Java 17, где противники — файлы и каталоги, а урон наносится через преобразование их HP. Проект подходит как техническое демо и как пример детерминированного генератора уровней.

## Возможности
- **Детерминированные забеги**: одинаковые `seed` и snapshot воспроизводят идентичные карты.
- **Три режима запуска**:
  - `sandbox` — виртуальная карта без доступа к ФС;
  - `readonlyscan` — сканирование реальной директории без записи;
  - `demo` — готовые snapshot-файлы.
- **Боёвка через «утилиты»**: `baseconv`, `fmt`, `sanitize`, `hash`, `grep`, `sed`, `determinism`, `entropy` меняют представление HP врагов.
- **ASCII-визуализация без мерцания** и управление `WASD`; `u` открывает панель утилит, `q` — выход.
- **Снимки уровней** лежат в `src/main/resources/snapshots/`.

## Установка и сборка
Требуются Java 17+ и Maven.

```bash
mvn -q package
```

Готовый jar появится в `target/workdir-roguelike-0.1.0-shaded.jar`.

## Запуск
Пример запуска демо с фиксированным seed:

```bash
java -jar target/workdir-roguelike-0.1.0-shaded.jar --seed=12345 --mode=demo
```

Параметры командной строки:
- `--seed=<число>` — фиксирует генерацию.
- `--mode=sandbox|readonlyscan|demo` — выбор источника карты.
- `--snapshot=<путь>` — JSON-снимок уровня или директория для `readonlyscan`.

## Игровой процесс
1. Перемещайтесь по сетке (`WASD`).
2. Сталкивайтесь с врагами-файлами и применяйте утилиты (`u` → цифра).
3. Утилиты меняют основание/формат/энтропию HP противника, после чего базовая атака добивает.
4. Энергия восстанавливается по 2 за ход; учитывайте щит и очки здоровья.

## Безопасность
- В режимах `sandbox` и `demo` чтение ФС не требуется.
- В `readonlyscan` сканируются только имена и типы узлов, без записи и удаления.

## Тесты
Запуск unit-тестов и детерминированного headless-теста:

```bash
mvn -q test
```

## CI
GitHub Actions (`.github/workflows/ci.yml`) выполняют:
- `mvn test`;
- сборку fat-jar через shade;
- загрузку jar как артефакта.

## Структура проекта
- `src/main/java/org/terpg/workdir` — ядро игры, утилиты, генератор уровней.
- `src/main/resources/snapshots` — демо-снимки для режима `demo`.
- `src/test/java/org/terpg/workdir` — unit-тесты и проверки детерминизма.
